#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# LOAD LOGS DIRECTLY INTO ELASTICSEARCH
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ADAPT VALUES
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


export APP_NAME=robot-shop
export INDEX_TYPE=logs
export TRAINING_DATA_URL=https://github.com/niklaushirt/ibm-aiops-trainingdata.git





if [[  $AIOPS_NAMESPACE =~ "" ]]; then
    # Get Namespace from Cluster 
    echo "   ------------------------------------------------------------------------------------------------------------------------------"
    echo "   üî¨ Getting Installation Namespace"
    echo "   ------------------------------------------------------------------------------------------------------------------------------"
    export AIOPS_NAMESPACE=$(oc get po -A|grep aiops-orchestrator-controller |awk '{print$1}')
    echo "       ‚úÖ OK - IBMAIOps:    $AIOPS_NAMESPACE"
fi

#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# DO NOT EDIT BELOW
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

echo "   ------------------------------------------------------------------------------------------------------------------------------"
echo "   üåè Getting Training Data from $TRAINING_DATA_URL"
echo "   ------------------------------------------------------------------------------------------------------------------------------"
rm -r -f ./tools/02_training/TRAINING_FILES
git clone $TRAINING_DATA_URL ./tools/02_training/TRAINING_FILES/ELASTIC/


# read -p "Decompress Demo Logs? [y,N] " DO_COMM
# if [[ $DO_COMM == "y" ||  $DO_COMM == "Y" ]]; then
echo "   ------------------------------------------------------------------------------------------------------------------------------"
echo "   üì¶ Uncompressing log anomaly training files"
echo "   ------------------------------------------------------------------------------------------------------------------------------"
unzip -o ./tools/02_training/TRAINING_FILES/ELASTIC/robot-shop/logs/data-log-training.zip -d ./tools/02_training/TRAINING_FILES/ELASTIC/robot-shop/logs>/dev/null 2>&1
# else
#     echo "‚ùå Skipped"
# fi

echo "***************************************************************************************************************************************************"
echo "  "
echo "  ‚è± This will take some time (up to 45 minutes"
echo "  üì• Indexes will count up to approx 320000 and 390000 respectively."
echo "  "
echo "***************************************************************************************************************************************************"

echo ""
./tools/02_training/scripts/load-es-index.sh

rm -r -f ./tools/02_training/TRAINING_FILES

