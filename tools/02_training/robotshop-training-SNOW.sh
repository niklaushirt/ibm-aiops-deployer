
export APP_NAME=robot-shop
export INDEX_TYPE=changerisk


#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# DO NOT EDIT BELOW
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------



if [[  $AIOPS_NAMESPACE =~ "" ]]; then
    # Get Namespace from Cluster 
    echo "   ------------------------------------------------------------------------------------------------------------------------------"
    echo "   üî¨ Getting Installation Namespace"
    echo "   ------------------------------------------------------------------------------------------------------------------------------"
    export AIOPS_NAMESPACE=$(oc get po -A|grep aiops-orchestrator-controller |awk '{print$1}')
    echo "       ‚úÖ IBMAIOps:         OK - $AIOPS_NAMESPACE"
else
    echo "       ‚úÖ IBMAIOps:         OK - $AIOPS_NAMESPACE"
fi




if [[ $ROUTE =~ "ai-platform-api" ]]; then
    echo "       ‚úÖ OK - Route:         OK"
else
    echo "       üõ†Ô∏è   Creating Route"
    oc create route passthrough ai-platform-api -n $AIOPS_NAMESPACE  --service=aimanager-aio-ai-platform-api-server --port=4000 --insecure-policy=Redirect --wildcard-policy=None
    export ROUTE=$(oc get route -n $AIOPS_NAMESPACE ai-platform-api  -o jsonpath={.spec.host})
    echo "        Route: $ROUTE"
    echo ""
fi
echo ""




echo "  ***************************************************************************************************************************************************"
echo "   üõ†Ô∏è   Create Analysis Definiton: Change Risk"
export FILE_NAME=create-analysis-CR.graphql
./tools/02_training/scripts/execute-graphql.sh

echo "  ***************************************************************************************************************************************************"
echo "   üõ†Ô∏è   Create Analysis Definiton: Similar Incidents"
export FILE_NAME=create-analysis-SI.graphql
./tools/02_training/scripts/execute-graphql.sh

echo "  ***************************************************************************************************************************************************"
echo "   üõ†Ô∏è   Run Analysis: Change Risk"
export FILE_NAME=run-analysis-CR.graphql
./tools/02_training/scripts/execute-graphql.sh

echo "  ***************************************************************************************************************************************************"
echo "   üõ†Ô∏è   Run Analysis: Similar Incidents"
export FILE_NAME=run-analysis-SI.graphql
./tools/02_training/scripts/execute-graphql.sh



